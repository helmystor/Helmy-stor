<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Stor - Ø´Ø­Ù† Ø¬ÙˆØ§Ù‡Ø± Linky</title>
    <link rel="icon" type="image/png" href="helmy-logo.png">
    
    <!-- SEO -->
    <meta name="description" content="Ù…ÙˆÙ‚Ø¹ Helmy Stor ÙŠÙ‚Ø¯Ù… Ø®Ø¯Ù…Ø§Øª Ø´Ø­Ù† Ø¬ÙˆØ§Ù‡Ø± Ù„Ø¹Ø¨Ø© Linky Ø¨Ø£Ø±Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©">
    <meta name="keywords" content="Ø´Ø­Ù† Ø¬ÙˆØ§Ù‡Ø± Linky, Ø´Ø±Ø§Ø¡ Ø¬ÙˆØ§Ù‡Ø± Linky, Ø¬ÙˆØ§Ù‡Ø± Linky, Ù‡ÙŠÙ„Ù…ÙŠ Ø³ØªÙˆØ±, Helmy Stor">
    <meta name="author" content="Helmy Stor Team">
    
    <!-- ÙˆØ³ÙˆÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
    <meta property="og:title" content="Helmy Stor | Ø´Ø­Ù† Ø¬ÙˆØ§Ù‡Ø± Linky Ø¨Ø£Ø±Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±">
    <meta property="og:description" content="Ø£ÙØ¶Ù„ Ù…ÙˆÙ‚Ø¹ Ù„Ø´Ø­Ù† ÙˆØ´Ø±Ø§Ø¡ Ø¬ÙˆØ§Ù‡Ø± Linky Ø¨Ø£Ø±Ø®Øµ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±">
    <meta property="og:type" content="website">
    
    <!-- Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ÙƒÙ„ Ø§Ù„CSS Ø§Ù„Ø³Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ */
        :root {
            --primary: #7B1FA2;
            --secondary: #CE93D8;
            --accent: #BA68C8;
            --dark: #1A1A2E;
            --light: #F3E5F5;
            --success: #00C9A7;
            --warning: #FFC75F;
            --danger: #FF8066;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --diamond-gradient: linear-gradient(135deg, #4FC3F7, #29B6F6, #039BE5, #0277BD);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark) 0%, #2D1B3E 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„CSS ÙƒÙ…Ø§ Ù‡Ùˆ ØªÙ…Ø§Ù…Ø§Ù‹ ... */
        /* (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ù…Ù† Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚) */

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.4s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert.show {
            transform: translateX(0);
        }

        .alert.success {
            background: var(--success);
        }

        .alert.error {
            background: var(--danger);
        }

        .alert.info {
            background: var(--primary);
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin: 10px 0;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div id="homePage" class="page active">
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
            <header>
                <div class="logo-container">
                    <div class="logo">
                        <img src="helmy-logo.png" alt="Helmy Stor">
                    </div>
                    <div>
                        <div class="logo-text">Helmy Stor</div>
                        <div class="logo-subtitle">Linky Diamonds Service</div>
                    </div>
                </div>

                <button class="menu-toggle" onclick="toggleMenu()">
                    <i class="fas fa-bars"></i>
                </button>

                <nav id="mainNav">
                    <a href="#" onclick="showPage('homePage')" class="nav-link">
                        <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                    <a href="#" onclick="showPage('ordersPage')" class="nav-link">
                        <i class="fas fa-shopping-bag"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
                    </a>
                    <a href="#" onclick="downloadApp()" class="nav-link nav-link-download">
                        <i class="fas fa-download"></i> Ù†Ø²Ù„ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§
                    </a>
                    <a href="#" onclick="logout()" class="nav-link nav-link-logout">
                        <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </a>
                </nav>
            </header>

            <!-- Ø®Ø¯Ù…Ø§Øª Ø¬ÙˆØ§Ù‡Ø± Linky -->
            <div class="service-tabs">
                <div class="service-tab active">
                    <i class="fas fa-gem"></i> Ø®Ø¯Ù…Ø§Øª Ø¬ÙˆØ§Ù‡Ø± Linky
                </div>
            </div>

            <div id="linkyService" class="service-content">
                <!-- Ø§Ù„Ù‡ÙŠØ±Ùˆ -->
                <section class="hero">
                    <h1>Ù…ØµØ¯Ø±Ùƒ Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ Ù„Ø¬ÙˆØ§Ù‡Ø± Linky</h1>
                    <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¬ÙˆØ§Ù‡Ø± Linky Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ£Ø³Ø±Ø¹ Ø®Ø¯Ù…Ø©</p>
                    <a href="#packages" class="btn">
                        <i class="fas fa-shopping-cart"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†
                    </a>
                </section>

                <!-- Ø§Ù„Ù…ÙŠØ²Ø§Øª -->
                <section class="features">
                    <div class="feature-card">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆØ¯Ø©</h3>
                        <p>Ø¬ÙˆØ§Ù‡Ø± Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø£Ù…ÙˆØ§Ù„</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-bolt"></i>
                        <h3>ØªØ³Ù„ÙŠÙ… ÙÙˆØ±ÙŠ</h3>
                        <p>Ø®Ù„Ø§Ù„ 10-20 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-lock"></i>
                        <h3>Ø¢Ù…Ù† ØªÙ…Ø§Ù…Ø§Ù‹</h3>
                        <p>Ù„Ø§ ØªØ­ØªØ§Ø¬ Ù„ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø­Ø³Ø§Ø¨Ùƒ</p>
                    </div>
                </section>

                <!-- Ø§Ù„Ø¨Ø§Ù‚Ø§Øª -->
                <section class="packages-section" id="packages">
                    <h2 class="section-title diamond">Ø¨Ø§Ù‚Ø§Øª Ø¬ÙˆØ§Ù‡Ø± Linky</h2>
                    
                    <!-- Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø© -->
                    <div class="package-grid">
                        <div class="package-card diamond">
                            <div class="package-icon">ğŸ’</div>
                            <div class="package-amount diamond">1,000</div>
                            <div style="font-size: 1.1rem; margin-bottom: 15px; opacity: 0.8;">Ø¬ÙˆÙ‡Ø±Ø© Linky</div>
                            <div class="package-price">10 Ø¬Ù†ÙŠÙ‡</div>
                            <button class="btn diamond" onclick="selectPackage(1000, 10, 'linky', 'Ø¬ÙˆØ§Ù‡Ø±')">
                                <i class="fas fa-shopping-cart"></i> Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©
                            </button>
                        </div>
                        
                        <div class="package-card diamond">
                            <div class="package-icon">ğŸ’</div>
                            <div class="package-amount diamond">2,500</div>
                            <div style="font-size: 1.1rem; margin-bottom: 15px; opacity: 0.8;">Ø¬ÙˆÙ‡Ø±Ø© Linky</div>
                            <div class="package-price">20 Ø¬Ù†ÙŠÙ‡</div>
                            <button class="btn diamond" onclick="selectPackage(2500, 20, 'linky', 'Ø¬ÙˆØ§Ù‡Ø±')">
                                <i class="fas fa-shopping-cart"></i> Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©
                            </button>
                        </div>
                        
                        <div class="package-card diamond">
                            <div class="package-icon">ğŸ’</div>
                            <div class="package-amount diamond">3,500</div>
                            <div style="font-size: 1.1rem; margin-bottom: 15px; opacity: 0.8;">Ø¬ÙˆÙ‡Ø±Ø© Linky</div>
                            <div class="package-price">30 Ø¬Ù†ÙŠÙ‡</div>
                            <button class="btn diamond" onclick="selectPackage(3500, 30, 'linky', 'Ø¬ÙˆØ§Ù‡Ø±')">
                                <i class="fas fa-shopping-cart"></i> Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©
                            </button>
                        </div>
                    </div>

                    <!-- Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù…ÙŠØ²Ø© -->
                    <h2 class="section-title diamond">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h2>
                    <div class="package-grid">
                        <div class="package-card diamond">
                            <div class="package-icon">ğŸ’</div>
                            <div class="package-amount diamond">8,000</div>
                            <div style="font-size: 1.1rem; margin-bottom: 15px; opacity: 0.8;">Ø¬ÙˆÙ‡Ø±Ø© Linky</div>
                            <div class="package-price">60 Ø¬Ù†ÙŠÙ‡</div>
                            <button class="btn diamond" onclick="selectPackage(8000, 60, 'linky', 'Ø¬ÙˆØ§Ù‡Ø±')">
                                <i class="fas fa-crown"></i> Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©
                            </button>
                        </div>
                        
                        <div class="package-card diamond">
                            <div class="package-icon">ğŸ’</div>
                            <div class="package-amount diamond">20,000</div>
                            <div style="font-size: 1.1rem; margin-bottom: 15px; opacity: 0.8;">Ø¬ÙˆÙ‡Ø±Ø© Linky</div>
                            <div class="package-price">160 Ø¬Ù†ÙŠÙ‡</div>
                            <button class="btn diamond" onclick="selectPackage(20000, 160, 'linky', 'Ø¬ÙˆØ§Ù‡Ø±')">
                                <i class="fas fa-crown"></i> Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ -->
            <section class="contact-section">
                <div class="contact-bar">
                    <a href="https://wa.me/+201122223344" class="contact-item" target="_blank">
                        <div class="contact-icon">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="contact-info">
                            <div class="contact-title">ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¯Ø¹Ù…</div>
                            <div class="contact-desc">01122223344</div>
                        </div>
                    </a>
                    
                    <a href="tel:01099342969" class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="contact-info">
                            <div class="contact-title">Ø±Ù‚Ù… Ø§Ù„Ø¯ÙØ¹</div>
                            <div class="contact-desc">01099342969</div>
                        </div>
                    </a>
                </div>
            </section>
        </div>

        <!-- ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
        <div id="ordersPage" class="page">
            <header>
                <div class="logo-container">
                    <div class="logo">
                        <img src="helmy-logo.png" alt="Helmy Stor">
                    </div>
                    <div>
                        <div class="logo-text">Helmy Stor</div>
                        <div class="logo-subtitle">Linky Diamonds Service</div>
                    </div>
                </div>

                <button class="menu-toggle" onclick="toggleMenu()">
                    <i class="fas fa-bars"></i>
                </button>

                <nav id="ordersNav">
                    <a href="#" onclick="showPage('homePage')" class="nav-link">
                        <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                    <a href="#" onclick="showPage('ordersPage')" class="nav-link">
                        <i class="fas fa-shopping-bag"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
                    </a>
                    <a href="#" onclick="downloadApp()" class="nav-link nav-link-download">
                        <i class="fas fa-download"></i> Ù†Ø²Ù„ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§
                    </a>
                </nav>
            </header>

            <h2 class="section-title diamond" style="margin-top: 30px;">Ø·Ù„Ø¨Ø§ØªÙŠ</h2>
            <div id="ordersList">
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>

        <!-- ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ -->
        <div id="paymentPage" class="page">
            <header>
                <div class="logo-container">
                    <div class="logo">
                        <img src="helmy-logo.png" alt="Helmy Stor">
                    </div>
                    <div>
                        <div class="logo-text">Helmy Stor</div>
                        <div class="logo-subtitle">Linky Diamonds Service</div>
                    </div>
                </div>

                <button class="menu-toggle" onclick="toggleMenu()">
                    <i class="fas fa-bars"></i>
                </button>

                <nav id="paymentNav">
                    <a href="#" onclick="showPage('homePage')" class="nav-link">
                        <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                    <a href="#" onclick="showPage('ordersPage')" class="nav-link">
                        <i class="fas fa-shopping-bag"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
                    </a>
                </nav>
            </header>

            <div class="payment-page">
                <h2 style="text-align: center; margin-bottom: 30px; font-size: 2rem;">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h2>

                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                    <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h3>
                    <p id="selectedPackageInfo" style="font-size: 1.1rem; margin-top: 10px;">Ø¨Ø§Ù‚Ø© 1,000 Ø¬ÙˆÙ‡Ø±Ø© - 10 Ø¬Ù†ÙŠÙ‡</p>
                </div>

                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                    <h3>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
                    <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0;">
                        <i class="fas fa-mobile-alt" style="font-size: 30px; color: var(--accent);"></i>
                        <div>
                            <p style="margin-bottom: 5px;">Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</p>
                            <p style="font-size: 1.5rem; font-weight: bold; color: var(--accent);">01099342969</p>
                        </div>
                    </div>
                    <p style="opacity: 0.8; font-size: 0.9rem;">ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø£Ø¹Ù„Ø§Ù‡ Ø«Ù… Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹</p>
                </div>

                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">ID Linky Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</label>
                    <input type="text" id="linkyId" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Linky">
                </div>

                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="phone" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„ØªÙˆØ§ØµÙ„">
                </div>

                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹</label>
                    <input type="file" id="receipt" class="form-control" accept="image/*" onchange="previewReceipt(event)">
                    <small style="color: var(--accent); font-size: 0.8rem;">PNG, JPG, JPEG - Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB</small>
                    
                    <div class="receipt-preview">
                        <img id="receiptPreview" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„">
                    </div>

                    <div class="progress-bar" id="uploadProgress">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <button class="btn diamond" style="width: 100%;" onclick="submitOrder()">
                    <i class="fas fa-paper-plane"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
                </button>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="alertArea"></div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // âœ… ØªÙƒÙˆÙŠÙ† Firebase Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Helmy Stor
        const firebaseConfig = {
            apiKey: "AIzaSyBoY17p1utIAzGcxtT9ecWz07N7wOMB9XI",
            authDomain: "helmy-48b8e.firebaseapp.com",
            projectId: "helmy-48b8e",
            storageBucket: "helmy-48b8e.firebasestorage.app",
            messagingSenderId: "410548528210",
            appId: "1:410548528210:web:2185ffd8e14018683a6b8b",
            measurementId: "G-5GJBGQ09LG"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let selectedPackage = { amount: 1000, price: 10, service: 'linky', type: 'Ø¬ÙˆØ§Ù‡Ø±' };
        let currentUser = null;

        // ğŸ”§ ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
        function showAlert(message, type = 'info') {
            const alertArea = document.getElementById('alertArea');
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            alertArea.appendChild(alert);
            
            setTimeout(() => alert.classList.add('show'), 100);
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 400);
            }, 4000);
        }

        function showProgress(percent) {
            const progressBar = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'block';
            progressFill.style.width = percent + '%';
        }

        function hideProgress() {
            const progressBar = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            progressBar.style.display = 'none';
            progressFill.style.width = '0%';
        }

        function disableButton(button, text = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...') {
            button.disabled = true;
            const originalHTML = button.innerHTML;
            button.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text}`;
            return originalHTML;
        }

        function enableButton(button, originalHTML) {
            button.disabled = false;
            button.innerHTML = originalHTML;
        }

        // ğŸ“± ========== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ ==========
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'ordersPage') {
                loadOrders();
            }
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø©
            document.querySelectorAll('nav').forEach(menu => menu.classList.remove('show'));
        }

        function toggleMenu() {
            const currentPage = document.querySelector('.page.active').id;
            const navId = currentPage === 'homePage' ? 'mainNav' : 
                         currentPage === 'ordersPage' ? 'ordersNav' : 'paymentNav';
            const navMenu = document.getElementById(navId);
            navMenu.classList.toggle('show');
        }

        // ğŸ›’ ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ==========
        function selectPackage(amount, price, service, type) {
            selectedPackage = { amount, price, service, type };
            document.getElementById('selectedPackageInfo').textContent = 
                `Ø¨Ø§Ù‚Ø© ${amount.toLocaleString()} Ø¬ÙˆÙ‡Ø±Ø© - ${price} Ø¬Ù†ÙŠÙ‡`;
            showPage('paymentPage');
        }

        // ğŸ–¼ï¸ ========== Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙˆØ± ==========
        function previewReceipt(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('receiptPreview');
            
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 5MB', 'error');
                    event.target.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        }

        function compressImage(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const maxWidth = 1200;
                    const maxHeight = 1200;
                    
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width = width * ratio;
                        height = height * ratio;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.toBlob(function(blob) {
                        const reader = new FileReader();
                        reader.onload = function() {
                            resolve(reader.result);
                        };
                        reader.readAsDataURL(blob);
                    }, 'image/jpeg', 0.7);
                };
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        // ğŸ“ ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ==========
        async function submitOrder() {
            const linkyId = document.getElementById('linkyId').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const receiptFile = document.getElementById('receipt').files[0];
            const submitButton = document.querySelector('#paymentPage button[onclick="submitOrder()"]');

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!linkyId) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ID Linky Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ', 'error');
                return;
            }
            
            if (!phone || phone.length < 10) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            if (!receiptFile) {
                showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹', 'error');
                return;
            }

            const originalButtonHTML = disableButton(submitButton, 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...');

            try {
                showProgress(10);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                const user = auth.currentUser;
                if (!user) {
                    showAlert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    window.location.href = 'login.html';
                    return;
                }

                showProgress(30);
                
                // Ø¶ØºØ· ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                let receiptBase64;
                if (receiptFile.size > 1024 * 1024) { // Ø£ÙƒØ«Ø± Ù…Ù† 1MB
                    receiptBase64 = await compressImage(receiptFile);
                } else {
                    receiptBase64 = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.readAsDataURL(receiptFile);
                    });
                }

                showProgress(60);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù‚Ù… Ø·Ù„Ø¨ ÙØ±ÙŠØ¯
                const orderId = 'HLM' + Date.now().toString().slice(-6) + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                
                // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø·Ù„Ø¨
                const order = {
                    package: selectedPackage,
                    userInput: linkyId,
                    phone: phone,
                    receiptImage: receiptBase64,
                    status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                    date: new Date().toLocaleDateString('ar-EG'),
                    time: new Date().toLocaleTimeString('ar-EG'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    orderId: orderId,
                    userId: user.uid,
                    email: user.email,
                    countInProfit: false
                };

                showProgress(80);
                
                // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Firestore
                await db.collection('orders').add(order);
                
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                try {
                    await db.collection('users').doc(user.uid).set({
                        email: user.email,
                        name: user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù… Helmy Stor',
                        phone: phone,
                        linkyId: linkyId,
                        lastOrder: firebase.firestore.FieldValue.serverTimestamp(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }, { merge: true });
                } catch (userError) {
                    console.log('Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù„ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙØ´Ù„', userError);
                }

                showProgress(100);
                
                // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                showAlert(`âœ… ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${orderId}`, 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('linkyId').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('receipt').value = '';
                document.getElementById('receiptPreview').style.display = 'none';
                
                setTimeout(() => {
                    showPage('ordersPage');
                    hideProgress();
                }, 2000);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨:', error);
                hideProgress();
                
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨. ';
                if (error.code === 'permission-denied') {
                    errorMessage += 'ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø°ÙˆÙ†Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
                } else if (error.code === 'unavailable') {
                    errorMessage += 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.';
                } else {
                    errorMessage += 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                }
                
                showAlert(errorMessage, 'error');
            } finally {
                enableButton(submitButton, originalButtonHTML);
            }
        }

        async function loadOrders() {
            const ordersList = document.getElementById('ordersList');
            
            try {
                ordersList.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 40px; margin-bottom: 20px;"></i>
                        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
                    </div>
                `;
                
                const user = auth.currentUser;
                if (!user) {
                    ordersList.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 40px; margin-bottom: 20px; color: var(--warning);"></i>
                            <h3>ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
                            <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                            <button onclick="window.location.href='login.html'" class="btn" style="margin-top: 20px;">
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                const snapshot = await db.collection('orders')
                    .where('userId', '==', user.uid)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    ordersList.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-shopping-cart" style="font-size: 40px; margin-bottom: 20px; opacity: 0.5;"></i>
                            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h3>
                            <p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>
                            <button onclick="showPage('homePage')" class="btn" style="margin-top: 20px;">
                                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let ordersHTML = '';
                snapshot.forEach(doc => {
                    const order = doc.data();
                    const statusClass = order.status === 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„' ? 'status-completed' : 'status-pending';
                    const statusText = order.status || 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
                    
                    ordersHTML += `
                        <div class="order-item" style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <strong>Ø·Ù„Ø¨ #${order.orderId || doc.id.slice(-6)}</strong>
                                    <p style="margin-top: 5px; opacity: 0.8;">
                                        ğŸ’ ${order.package?.amount?.toLocaleString() || '0'} Ø¬ÙˆÙ‡Ø±Ø© - ${order.package?.price || '0'} Ø¬Ù†ÙŠÙ‡
                                    </p>
                                </div>
                                <span class="${statusClass}">${statusText}</span>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px;">
                                <p><strong>ğŸ® ID Linky:</strong> ${order.userInput || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                <p><strong>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${order.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                <p><strong>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.date || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} ${order.time || ''}</p>
                                
                                ${order.receiptImage ? `
                                    <div style="margin-top: 10px;">
                                        <button onclick="showReceipt('${order.receiptImage.replace(/'/g, "\\'")}', '${order.orderId}')" 
                                                class="btn" style="padding: 8px 15px; font-size: 14px;">
                                            <i class="fas fa-image"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                ordersList.innerHTML = ordersHTML;
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
                ordersList.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 40px; margin-bottom: 20px; color: var(--danger);"></i>
                        <h3>Ø­Ø¯Ø« Ø®Ø·Ø£</h3>
                        <p>${error.message || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª'}</p>
                        <button onclick="loadOrders()" class="btn" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                        </button>
                    </div>
                `;
            }
        }

        function showReceipt(base64Image, orderId) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
            `;
            
            modal.innerHTML = `
                <div style="position: relative; max-width: 90%; max-height: 90%;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: -40px; right: 0; 
                                   background: var(--danger); color: white; 
                                   border: none; border-radius: 50%; 
                                   width: 30px; height: 30px; cursor: pointer;">
                        âœ•
                    </button>
                    <img src="${base64Image}" 
                         style="max-width: 100%; max-height: 80vh; border-radius: 10px; border: 2px solid var(--accent);">
                    <p style="text-align: center; margin-top: 10px; color: white;">Ø¥ÙŠØµØ§Ù„ Ø·Ù„Ø¨ ${orderId}</p>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        function downloadApp() {
            showAlert('Ø³ÙŠØ¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø±ÙŠØ¨Ø§Ù‹...', 'info');
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§
        }

        async function logout() {
            try {
                await auth.signOut();
                localStorage.removeItem('helmy_user_id');
                localStorage.removeItem('helmy_user_email');
                window.location.href = 'login.html';
            } catch (error) {
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        }

        // ğŸš€ ========== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Helmy Stor Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!');
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
            auth.onAuthStateChanged((user) => {
                currentUser = user;
                if (!user && !window.location.href.includes('login.html') && !window.location.href.includes('signup.html')) {
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 100);
                }
            });
        });
    </script>
</body>
</html>
